LoadModule mpm_event_module modules/mod_mpm_event.so
ServerName wrrm.lat

Listen 443

LoadModule ssl_module modules/mod_ssl.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so

<VirtualHost *:443>
    SSLEngine on

    SSLCertificateFile "/etc/ssl/certs/wrrm_lat.crt"
    SSLCertificateKeyFile "/etc/ssl/private/wrrm.lat.key"
    SSLCertificateChainFile "/etc/ssl/certs/wrrm_lat.ca-bundle"

    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"

    # Extended timeouts for image processing
    ProxyTimeout 300
    ProxyBadHeader Ignore

    # üîÅ Proxy API/backend paths to backend container
    ProxyPass /serve-image http://backend:8001/serve-image timeout=300
    ProxyPassReverse /serve-image http://backend:8001/serve-image

    # üåê Proxy everything else to frontend
    ProxyPass / http://frontend:80/
    ProxyPassReverse / http://frontend:80/
</VirtualHost>
